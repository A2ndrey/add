vanessaPlatforms = ["8.3.14.1630", "8.3.15.1489"]
ordinaryApps = ["0","1"]

childJobNamePrefix = "Vanessa-ADD-Docker-"

pipeline {

    agent any

    options {
      buildDiscarder(logRotator(numToKeepStr: '10'))
      disableConcurrentBuilds()
      timestamps() 
    }

    stages {

       stage("Matrix") {
            steps {
                script {
                    parallel getTasks()
                }
            }
        }
    }
}

def getTasks() {
    def tasks = [:]
    for(int i=0; i< vanessaPlatforms.size(); i++) {
        def vanessaPlatformsValue = vanessaPlatforms[i]
        for(int j=0; j< ordinaryApps.size(); j++) {
            def ordinaryApp = ordinaryApps[j]
            tasks["${vanessaPlatformsValue}/${ordinaryApp}"] = {
                build job: "${childJobNamePrefix}${vanessaPlatformsValue}",
                         parameters:    [[$class: 'StringParameterValue', name: 'V8VERSION', value: "${vanessaPlatformsValue}"],
                                        [$class: 'StringParameterValue', name:'ORDINARY_APP', value: "${ordinaryApp}"]]
            }
        }
    }
    tasks["failFast"]=false
    return tasks
}
